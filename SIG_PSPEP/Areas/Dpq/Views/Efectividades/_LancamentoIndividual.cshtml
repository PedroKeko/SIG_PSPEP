@model SIG_PSPEP.Entidades.EfectivoEfectividade

<link rel="stylesheet" type="text/css" href="~/assets/libs/select2/dist/css/select2.min.css" />
<style>
    .select2-container .select2-selection--single {
        height: 33px !important;
        font-size: 14px !important;
        padding: 2px 8px !important;
        display: flex !important;
        align-items: center !important;
        border: 1px solid #ced4da;
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
        font-size: 13px !important;
        line-height: 40px !important;
    }

    .select2-container .select2-search--dropdown .select2-search__field {
        height: 30px !important;
        font-size: 13px !important;
        padding: 4px 8px !important;
    }

    .select2-container .select2-results__option {
        font-size: 13px !important;
    }

    .select2-results__option {
        padding: 5px !important;
        user-select: none;
        -webkit-user-select: none
    }

</style>

<div class="container">

    <input type="hidden" id="DataPresencaHidden" value="@(Model.DataPresenca.HasValue? Model.DataPresenca.Value.ToString("yyyy-MM-dd") : "")" />

    <div class="mb-1">
        <label class="form-label">Efectivo</label>
        <select id="EfectivoId" class="form-control form-control-sm select2" asp-items="ViewBag.Efectivos">
            <option value="">-- Selecionar Efectivo --</option>
        </select>
    </div>

    <div class="row g-2 mb-1">
        <div class="col-md-3">
            <label class="form-label">Data</label>
            <input id="DataPresenca" type="date" class="form-control form-control-sm"
                   value="@(Model.DataPresenca.HasValue? Model.DataPresenca.Value.ToString("yyyy-MM-dd") : "")"
                   readonly />
        </div>
        <div class="col-md-9">
            <label class="form-label">Tipo de Efetividade</label>
            <select id="EfectividadeTipoId" class="form-control form-control-sm select2" asp-items="ViewBag.EfectividadeTipos">
                <option value="">-- Selecionar Tipo --</option>
            </select>
        </div>
    </div>

    <div class="col-md-12">
        <label class="form-label">Justificação</label>
        <textarea id="Justificacao" class="form-control form-control-sm" rows="3" placeholder="Justifique apenas se for necessário"></textarea>
    </div>

</div>

<script src="~/assets/libs/select2/dist/js/select2.full.min.js"></script>
<script src="~/assets/libs/select2/dist/js/select2.min.js"></script>
<script>
    $(document).ready(function () {
        // Inicializa o select2 normal
        $('.select2').select2({
            dropdownParent: $('body'),
            width: '100%',
            language: {
                noResults: function () {
                    return "Nenhum resultado encontrado";
                }
            }
        });

        // Se for dentro de modal
        $(document).on('shown.bs.modal', '.modal', function () {
            $(this).find('.select2').each(function () {
                const $select = $(this);
                if ($select.hasClass('select2-hidden-accessible')) {
                    $select.select2('destroy');
                }
                $select.select2({
                    dropdownParent: $select.closest('.modal'),
                    width: '100%',
                    language: {
                        noResults: function () {
                            return "Nenhum resultado encontrado";
                        }
                    }
                });
            });
        });
    });
</script>

<script>
    $(document).ready(function() {
        // Inicializar Select2
        $('#EfectivoId, #EfectividadeTipoId').select2({
            width: '100%',
            theme: 'bootstrap-5',
            placeholder: '-- Selecionar --',
            allowClear: true,
            minimumResultsForSearch: 5 // somente pesquisa se tiver mais de 5 opções
        });

        // Bloquear textarea se tipo diferente de "Ausência Justificada"
        function toggleJustificacao() {
            const tipo = $('#EfectividadeTipoId').val();
            const $justificacao = $('#Justificacao');

            // Apenas Justificado (4) pode digitar
            if(tipo === '3' || tipo === '4'){
                $justificacao.prop('readonly', false);
                $justificacao.prop('disabled', false);
                $justificacao.attr('placeholder', 'Digite a justificativa da ausência ou dispensa(mínimo 10 caracteres)');
            } else {
                $justificacao.prop('readonly', true);
                $justificacao.prop('disabled', true);
                $justificacao.val('');
                $justificacao.attr('placeholder', 'Somente preenchido para Ausência Justificada ou Dispensa Formal');
            }
        }

        $('#EfectividadeTipoId').on('change', toggleJustificacao);
        toggleJustificacao(); // chama no load
    });
</script>

