@{
	ViewData["Title"] = "Painel de Contrle DPQ";
	Layout = "~/Areas/Dpq/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="~/assets/libs/flot/css/float-chart.css" rel="stylesheet" />
<style>
	.card-hover {
		border-radius: 12px;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
		transition: all 0.3s ease;
		background-color: #ffffff;
		position: relative; /* Importante para posicionar elementos absolutos dentro */
		overflow: hidden;
		min-height: 100px;
	}

		.card-hover:hover {
			box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
			transform: translateY(-3px);
		}

	.percente {
		position: absolute;
		top: 8px;
		left: 8px;
		background-color: rgba(255, 255, 255, 0.15); /* leve transparência */
		color: #ffffff;
		font-size: 14px;
		font-weight: bold;
		padding: 2px 6px;
		border-radius: 8px;
		z-index: 10;
	}

	/* Responsividade: menor espaçamento em telas pequenas */
	@@media (max-width: 576px) {
		.percente {
			font-size: 13px;
			top: 10px;
			left: 10px;
			padding: 5px 10px;
		}
	}


	.metric-card {
		background: white;
		border-radius: 12px;
		padding: 20px;
		border: 1px solid #e3e6f0;
		box-shadow: 0 2px 8px rgba(0,0,0,0.08);
		transition: all 0.2s;
		height: 110px;
		position: relative;
		margin-bottom: 20px;
	}

		.metric-card:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0,0,0,0.12);
		}

	.metric-header {
		display: flex;
		justify-content: space-between;
		align-items: flex-start;
		margin-bottom: 15px;
	}

	.metric-title {
		color: #2c3e50;
		font-size: 1rem;
		font-weight: 600;
		margin: 0;
	}

	.metric-percentage {
		font-size: 0.9rem;
		font-weight: 600;
		margin: 0;
		display: flex;
		align-items: center;
		gap: 8px;
	}

	.metric-content {
		display: flex;
		align-items: center;
		height: calc(100% - 40px);
	}

	.metric-icon {
		width: 50px;
		height: 50px;
		border-radius: 10px;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 20px;
		color: white;
		margin-right: 20px;
	}

	.metric-values {
		flex: 1;
		text-align: center;
	}

	.metric-total {
		font-size: 2rem;
		font-weight: 700;
		color: #2c3e50;
		margin: 0;
		line-height: 1;
	}

	.metric-label {
		color: #6c757d;
		font-size: 0.8rem;
		margin-top: 4px;
	}

	/* Cores por tipo - Slide 1 */
	.upp .metric-icon {
		background: linear-gradient(135deg, #6c757d, #495057);
	}

	.upp .metric-percentage {
		color: #6c757d;
	}

	.upp {
		border-left: 4px solid #6c757d;
	}

	.upj .metric-icon {
		background: linear-gradient(135deg, #28a745, #20c997);
	}

	.upj .metric-percentage {
		color: #28a745;
	}

	.upj {
		border-left: 4px solid #28a745;
	}

	.upep .metric-icon {
		background: linear-gradient(135deg, #007bff, #17a2b8);
	}

	.upep .metric-percentage {
		color: #007bff;
	}

	.upep {
		border-left: 4px solid #007bff;
	}

	.upd .metric-icon {
		background: linear-gradient(135deg, #dc3545, #fd7e14);
	}

	.upd .metric-percentage {
		color: #dc3545;
	}

	.upd {
		border-left: 4px solid #dc3545;
	}

	/* Cores por tipo - Slide 2 */
	.ughh .metric-icon {
		background: linear-gradient(135deg, #28a745, #20c997);
	}

	.ughh .metric-percentage {
		color: #28a745;
	}

	.ughh {
		border-left: 4px solid #28a745;
	}

	.ubm .metric-icon {
		background: linear-gradient(135deg, #dc3545, #fd7e14);
	}

	.ubm .metric-percentage {
		color: #dc3545;
	}

	.ubm {
		border-left: 4px solid #dc3545;
	}

	.orgaos .metric-icon {
		background: linear-gradient(135deg, #007bff, #17a2b8);
	}

	.orgaos .metric-percentage {
		color: #007bff;
	}

	.orgaos {
		border-left: 4px solid #007bff;
	}

	.gabcmdtes .metric-icon {
		background: linear-gradient(135deg, #6c757d, #495057);
	}

	.gabcmdtes .metric-percentage {
		color: #6c757d;
	}

	.gabcmdtes {
		border-left: 4px solid #6c757d;
	}

	/* Carousel customization */
	.carousel-indicators {
		bottom: -40px;
	}

		.carousel-indicators button {
			width: 12px;
			height: 12px;
			border-radius: 50%;
			margin: 0 5px;
		}

	.carousel-control-prev,
	.carousel-control-next {
		width: 40px;
		height: 40px;
		top: 50%;
		transform: translateY(-50%);
		background: white;
		border-radius: 50%;
		box-shadow: 0 2px 8px rgba(0,0,0,0.15);
	}

	.carousel-control-prev {
		left: -60px;
	}

	.carousel-control-next {
		right: -60px;
	}

	.carousel-control-prev-icon,
	.carousel-control-next-icon {
		background-size: 20px;
		filter: brightness(0);
	}

	@@media (max-width: 768px) {
		.metric-card {
			height: auto;
			margin-bottom: 15px;
			padding: 15px;
		}

		.metric-content {
			flex-direction: column;
			gap: 15px;
			text-align: center;
		}

		.metric-icon {
			margin-right: 0;
			margin-bottom: 10px;
		}

		.metric-header {
			flex-direction: column;
			gap: 10px;
			text-align: center;
		}

		.carousel-control-prev,
		.carousel-control-next {
			display: none;
		}
	}
</style>

<div class="container-fluid">
	<div class="row">
		<!-- Total de Forças -->
		<div class="col-md-6 col-lg-4 col-xlg-3">
			<div class="card card-hover">
				<div style="background: #0d114f;" class="box text-center position-relative">
					<h6 class="text-white percente" id="percUniverso">-- % da PNA</h6>
					<h1 class="font-light text-white">
						<i class="fa fa-users"></i>
					</h1>
					<h6 class="text-white">Total de Forças da PSPEP</h6>
					<h4 class="text-white" id="totalEfectivos">--</h4>
				</div>
			</div>
		</div>

		<!-- Oficiais Comissário -->
		<div class="col-md-6 col-lg-2 col-xlg-3">
			<div class="card card-hover">
				<div style="background: #5c2750;" class="box text-center">
					<h1 class="font-light text-white">
						<i class="fa fa-star"></i>
					</h1>
					<h6 class="text-white">Of. Comissários</h6>
					<h4 class="text-white" id="ofComissarios">--</h4>
					<h6 class="text-white percente" id="percComissarios">-- %</h6>
				</div>
			</div>
		</div>

		<!-- Oficiais Superiores -->
		<div class="col-md-6 col-lg-2 col-xlg-3">
			<div class="card card-hover">
				<div style="background: #4caf50;" class="box text-center">
					<h1 class="font-light text-white">
						<i class="fa fa-star"></i>
					</h1>
					<h6 class="text-white">Oficiais Superiores</h6>
					<h4 class="text-white" id="ofSuperiores">--</h4>
					<h6 class="text-white percente" id="percSuperiores">-- %</h6>
				</div>
			</div>
		</div>

		<!-- Oficiais Subalternos -->
		<div class="col-md-6 col-lg-2 col-xlg-3">
			<div class="card card-hover">
				<div style="background: #ff9800;" class="box text-center">
					<h1 class="font-light text-white">
						<i class="fa fa-user-secret"></i>
					</h1>
					<h6 class="text-white">Subalternos</h6>
					<h4 class="text-white" id="ofSubalternos">--</h4>
					<h6 class="text-white percente" id="percSubalternos">-- %</h6>
				</div>
			</div>
		</div>

		<!-- Subchefes -->
		<div class="col-md-6 col-lg-2 col-xlg-3">
			<div class="card card-hover">
				<div style="background: #f44336;" class="box text-center">
					<h1 class="font-light text-white">
						<i class="fa fa-user-shield"></i>
					</h1>
					<h6 class="text-white">Subchefes</h6>
					<h4 class="text-white" id="subchefes">--</h4>
					<h6 class="text-white percente" id="percSubchefes">-- %</h6>
				</div>
			</div>
		</div>

		<!-- Agentes -->
		<div class="col-md-6 col-lg-2 col-xlg-3">
			<div class="card card-hover">
				<div style="background: #03a9f4;" class="box text-center">
					<h1 class="font-light text-white">
						<i class="fa fa-user"></i>
					</h1>
					<h6 class="text-white">Agentes</h6>
					<h4 class="text-white" id="agentes">--</h4>
					<h6 class="text-white percente" id="percAgentes">-- %</h6>
				</div>
			</div>
		</div>

		<!-- Efetivo Masculino -->
		<div class="col-md-6 col-lg-2 col-xlg-3">
			<div class="card card-hover">
				<div style="background: #004;" class="box text-center">
					<h1 class="font-light text-white">
						<i class="fa fa-male"></i>
					</h1>
					<h6 class="text-white">Efetivo Masculino</h6>
					<h4 class="text-white" id="totalMasculino">--</h4>
					<h6 class="text-white percente" id="percentagemMasculino">-- %</h6>
				</div>
			</div>
		</div>

		<!-- Efetivo Feminino -->
		<div class="col-md-6 col-lg-2 col-xlg-3">
			<div class="card card-hover">
				<div style="background: #e91e63;" class="box text-center">
					<h1 class="font-light text-white">
						<i class="fa fa-female"></i>
					</h1>
					<h6 class="text-white">Efetivo Feminino</h6>
					<h4 class="text-white" id="totalFeminino">--</h4>
					<h6 class="text-white percente" id="percentagemFeminino">-- %</h6>
				</div>
			</div>
		</div>

		<!-- Reformados -->
		<div class="col-md-6 col-lg-2 col-xlg-3">
			<div class="card card-hover">
				<div style="background: #8bc34a;" class="box text-center">
					<h1 class="font-light text-white">
						<i class="fa fa-user-plus"></i>
					</h1>
					<h6 class="text-white">Reformados</h6>
					<h4 class="text-white" id="">--</h4>
					<h6 class="text-white percente" id="">-- %</h6>
				</div>
			</div>
		</div>

		<!-- Transferidos -->
		<div class="col-md-6 col-lg-2 col-xlg-3">
			<div class="card card-hover">
				<div style="background: #673ab7;" class="box text-center">
					<h1 class="font-light text-white">
						<i class="fa fa-exchange-alt"></i>
					</h1>
					<h6 class="text-white">Transferidos</h6>
					<h4 class="text-white" id="">--</h4>
					<h6 class="text-white percente" id="">-- %</h6>
				</div>
			</div>
		</div>

		<!-- Efetivo em Formação -->
		<div class="col-md-6 col-lg-2 col-xlg-3">
			<div class="card card-hover">
				<div style="background: #ff5722;" class="box text-center">
					<h1 class="font-light text-white">
						<i class="fa fa-graduation-cap"></i>
					</h1>
					<h6 class="text-white">Em ISCPC</h6>
					<h4 class="text-white" id="">--</h4>
					<h6 class="text-white percente" id="">-- %</h6>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div id="cardCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000" data-bs-wrap="true">
			<div id="metricsCarousel" class="carousel slide" data-bs-ride="carousel">
				<!-- Indicators -->
				<div class="carousel-indicators">
					<button type="button" data-bs-target="#metricsCarousel" data-bs-slide-to="0" class="active"></button>
					<button type="button" data-bs-target="#metricsCarousel" data-bs-slide-to="1"></button>
				</div>

				<div class="carousel-inner">

					<!-- Slide 1 -->
					<div class="carousel-item active">
						<div class="row g-3">
							<!-- UPP -->
							<div class="col-md-6 col-lg-3">
								<div class="metric-card upp">
									<div class="metric-header">
										<h5 class="metric-title">Total UPP</h5>
										<div class="metric-percentage">
											<span class="peity_line_neutral" style="display: none">10,15,8,14,13,10,10</span>
											<span id="uppPerc">-- %</span>
										</div>
									</div>
									<div class="metric-content">
										<div class="metric-icon">
											<i class="fas fa-landmark"></i>
										</div>
										<div class="metric-values">
											<h3 class="metric-total" id="uppTotal">--</h3>
											<div class="metric-label">Efectivos</div>
										</div>
									</div>
								</div>
							</div>

							<!-- UPJ -->
							<div class="col-md-6 col-lg-3">
								<div class="metric-card upj">
									<div class="metric-header">
										<h5 class="metric-title">Total UPJ</h5>
										<div class="metric-percentage">
											<span class="peity_line_good" style="display: none">12,6,9,23,14,10,17</span>
											<span id="upjPerc">-- %</span>
										</div>
									</div>
									<div class="metric-content">
										<div class="metric-icon">
											<i class="fas fa-balance-scale"></i>
										</div>
										<div class="metric-values">
											<h3 class="metric-total" id="upjTotal">--</h3>
											<div class="metric-label">Efectivos</div>
										</div>
									</div>
								</div>
							</div>

							<!-- UPEP -->
							<div class="col-md-6 col-lg-3">
								<div class="metric-card upep">
									<div class="metric-header">
										<h5 class="metric-title">Total UPEP</h5>
										<div class="metric-percentage">
											<span class="peity_bar_good" style="display: none">12,6,9,23,14,10,13</span>
											<span id="upepPerc">-- %</span>
										</div>
									</div>
									<div class="metric-content">
										<div class="metric-icon">
											<i class="fas fa-user-tie"></i>
										</div>
										<div class="metric-values">
											<h3 class="metric-total" id="upepTotal">--</h3>
											<div class="metric-label">Efectivos</div>
										</div>
									</div>
								</div>
							</div>

							<!-- UPD -->
							<div class="col-md-6 col-lg-3">
								<div class="metric-card upd">
									<div class="metric-header">
										<h5 class="metric-title">Total UPD</h5>
										<div class="metric-percentage">
											<span class="peity_bar_bad" style="display: none">3,5,6,16,8,10,6</span>
											<span id="updPerc">-- %</span>
										</div>
									</div>
									<div class="metric-content">
										<div class="metric-icon">
											<i class="fas fa-globe"></i>
										</div>
										<div class="metric-values">
											<h3 class="metric-total" id="updTotal">--</h3>
											<div class="metric-label">Efectivos</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Slide 2 -->
					<div class="carousel-item">
						<div class="row g-3">
							<!-- UGHH -->
							<div class="col-md-6 col-lg-3">
								<div class="metric-card ughh">
									<div class="metric-header">
										<h5 class="metric-title">Total UGHH</h5>
										<div class="metric-percentage">
											<span class="peity_line_good" style="display: none">12,6,9,23,14,10,17</span>
											<span id="ughhPerc">-- %</span>
										</div>
									</div>
									<div class="metric-content">
										<div class="metric-icon">
											<i class="fas fa-flag"></i>
										</div>
										<div class="metric-values">
											<h3 class="metric-total" id="ughhTotal">--</h3>
											<div class="metric-label">Efectivos</div>
										</div>
									</div>
								</div>
							</div>

							<!-- UBM -->
							<div class="col-md-6 col-lg-3">
								<div class="metric-card ubm">
									<div class="metric-header">
										<h5 class="metric-title">Total UBM</h5>
										<div class="metric-percentage">
											<span class="peity_bar_bad" style="display: none">3,5,6,16,8,10,6</span>
											<span id="ubmPerc">-- %</span>
										</div>
									</div>
									<div class="metric-content">
										<div class="metric-icon">
											<i class="fas fa-music"></i>
										</div>
										<div class="metric-values">
											<h3 class="metric-total" id="ubmTotal">--</h3>
											<div class="metric-label">Efectivos</div>
										</div>
									</div>
								</div>
							</div>

							<!-- ÓRGÃOS -->
							<div class="col-md-6 col-lg-3">
								<div class="metric-card orgaos">
									<div class="metric-header">
										<h5 class="metric-title">ÓRGÃOS</h5>
										<div class="metric-percentage">
											<span class="peity_bar_good" style="display: none">12,6,9,23,14,10,13</span>
											<span id="comandoPerc">-- %</span>
										</div>
									</div>
									<div class="metric-content">
										<div class="metric-icon">
											<i class="fas fa-user-shield"></i>
										</div>
										<div class="metric-values">
											<h3 class="metric-total" id="comandoTotal">--</h3>
											<div class="metric-label">Efectivos</div>
										</div>
									</div>
								</div>
							</div>

							<!-- GABCMDTES -->
							<div class="col-md-6 col-lg-3">
								<div class="metric-card gabcmdtes">
									<div class="metric-header">
										<h5 class="metric-title">GAB-CMDTES</h5>
										<div class="metric-percentage">
											<span class="peity_line_neutral" style="display: none">10,15,8,14,13,10,10</span>
											<span id="gabinetesPerc">-- %</span>
										</div>
									</div>
									<div class="metric-content">
										<div class="metric-icon">
											<i class="fas fa-medal"></i>
										</div>
										<div class="metric-values">
											<h3 class="metric-total" id="gabinetesTotal">--</h3>
											<div class="metric-label">Efectivos</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

				</div>

				<!-- Controls -->
				<button class="carousel-control-prev" type="button" data-bs-target="#metricsCarousel" data-bs-slide="prev">
					<span class="carousel-control-prev-icon"></span>
				</button>
				<button class="carousel-control-next" type="button" data-bs-target="#metricsCarousel" data-bs-slide="next">
					<span class="carousel-control-next-icon"></span>
				</button>
			</div>
		</div>

	</div>
	<div class="row">
		<div class="col-md-12">
			<div class="card">
				<div class="card-body">
					<div class="d-md-flex align-items-center">
						<div>
							<h4 class="card-title">Registo de Efectivo por Unidade e Orgão</h4>
							<h5 class="card-subtitle">Últimos 12 Meses</h5>
						</div>
					</div>
					<div class="row">
						<!-- Gráfico -->
						<div class="col-lg-9">
							<div class="flot-chart">
								<div class="flot-chart-content" id="flot-line-chart"></div>
							</div>
						</div>

						<!-- Estatísticas -->
						<div class="col-lg-3">
							<div class="row">
								<div class="col-6">
									<div class="bg-dark p-10 text-white text-center">
										<i class="fa fa-user-friends fs-3 mb-1 mt-2"></i>
										<h5 class="mb-0 mt-1">2540</h5>
										<small class="font-light">Faltas/Mês</small>
									</div>
								</div>
								<div class="col-6">
									<div class="bg-dark p-10 text-white text-center">
										<i class="fa fa-user-check fs-3 mb-1 mt-2"></i>
										<h5 class="mb-0 mt-1">120</h5>
										<small class="font-light">Presenças/Mês</small>
									</div>
								</div>
								<div class="col-6 mt-3">
									<div class="bg-dark p-10 text-white text-center">
										<i class="fa fa-user-tie fs-3 mb-1 mt-2"></i>
										<h5 class="mb-0 mt-1">656</h5>
										<small class="font-light">Reformados/Ano</small>
									</div>
								</div>
								<div class="col-6 mt-3">
									<div class="bg-dark p-10 text-white text-center">
										<i class="fa fa-umbrella-beach fs-3 mb-1 mt-2"></i>
										<h5 class="mb-0 mt-1">9540</h5>
										<small class="font-light">Ferias/Ano</small>
									</div>
								</div>
								<div class="col-6 mt-3">
									<div class="bg-dark p-10 text-white text-center">
										<i class="fa fa-exchange-alt fs-3 mb-1 mt-2"></i>
										<h5 class="mb-0 mt-1">100</h5>
										<small class="font-light">Transferidos/Ano</small>
									</div>
								</div>
								<div class="col-6 mt-3">
									<div class="bg-dark p-10 text-white text-center">
										<i class="fa fa-skull fs-3 mb-1 mt-2"></i>
										<h5 class="mb-0 mt-1">8540</h5>
										<small class="font-light">Falecidos/Ano</small>
									</div>
								</div>
							</div>
						</div>
						<!-- /Estatísticas -->
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<!-- Gênero -->
		<div class="row mb-4">
			<div class="col-md-4 text-center d-flex justify-content-center align-items-center">
				<canvas id="generoChart" width="280" height="280"></canvas>
			</div>
			<div class="col-md-8">
				<canvas id="classeChart" style="width: 100%; height: 280px;"></canvas>
			</div>
		</div>

		<!-- Unidades e Faixa Etária -->
		<div class="row mb-4">
			<div class="col-md-6">
				<canvas id="unidadeChart" style="width: 100%; height: 280px;"></canvas>
			</div>
			<div class="col-md-6">
				<canvas id="faixaEtariaChart" style="width: 100%; height: 280px;"></canvas>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title">Quantidade de Forças por Unidades e Orgãos</h5>
					<div id="graficoEfectivos"></div>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
	<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
	<script src="~/assets/libs/chart/matrix.interface.js"></script>
	<script src="~/assets/libs/chart/matrix.charts.js"></script>
	<script src="../assets/libs/chart/matrix.interface.js"></script>
	<script src="../assets/libs/chart/excanvas.min.js"></script>
	<script src="../assets/libs/flot/jquery.flot.js"></script>
	<script src="../assets/libs/flot/jquery.flot.pie.js"></script>
	<script src="../assets/libs/flot/jquery.flot.time.js"></script>
	<script src="../assets/libs/flot/jquery.flot.stack.js"></script>
	<script src="../assets/libs/flot/jquery.flot.crosshair.js"></script>
	<script src="../assets/libs/chart/jquery.peity.min.js"></script>
	<script src="../assets/libs/chart/matrix.charts.js"></script>
	<script src="../assets/libs/chart/jquery.flot.pie.min.js"></script>
	<script src="../assets/libs/flot.tooltip/js/jquery.flot.tooltip.min.js"></script>
	<script src="../assets/libs/chart/turning-series.js"></script>

	<script>
		document.addEventListener("DOMContentLoaded", carregarDashboard);

		async function carregarDashboard() {
			try {
				const response = await fetch('@Url.Action("DashboardData", "Home", new { area = "Dpq" })');
				if (!response.ok) throw new Error("Erro ao buscar dados do servidor.");

				const data = await response.json();

				// Função utilitária para preencher texto
				const setText = (id, value) => {
					const el = document.getElementById(id);
					if (el) el.textContent = value;
				};

				// Cores padrão para gráficos
				const coresPadrao = ["#4e73df", "#f6c23e", "#36b9cc", "#1cc88a", "#ff6384", "#8e44ad", "#e67e22", "#2c3e50"];

				// Opções padrão com animação básica
				const opcoesAnimacaoBasica = {
					animation: false,
					responsive: false,
					plugins: {
						legend: { position: 'top' }
					}
				};

				// Totais gerais
				setText("totalEfectivos", data.totalEfectivos);
				setText("percUniverso", `${data.percentagemDoUniverso}% da PNA`);

				// Gráfico por Gênero
			if (document.getElementById("generoChart")) {
			new Chart(document.getElementById("generoChart"), {
				type: "pie",
				data: {
					labels: data.porGenero.map(g => g.genero),
					datasets: [{
						label: "Por Gênero",
						data: data.porGenero.map(g => g.total),
						backgroundColor: coresPadrao.slice(0, data.porGenero.length)
					}]
				},
				options: {
					responsive: false,
					plugins: {
						legend: {
							position: 'top'
						},
						datalabels: {
							formatter: (value, context) => {
								const dataArr = context.chart.data.datasets[0].data;
								const total = dataArr.reduce((a, b) => a + b, 0);
								const percentage = ((value / total) * 100).toFixed(2);
								return `${value} (${percentage}%)`;
							},
							color: '#fff',
							font: {
								weight: 'bold',
								size: 14
							}
						}
					}
				},
				plugins: [ChartDataLabels]
			});
		}


				// Gráfico por Classe
					if (document.getElementById("classeChart")) {
		  const ctx = document.getElementById("classeChart").getContext("2d");

		  // Soma total dos efetivos por classe para calcular a percentagem
		  const totais = data.porClasse.map(c => c.total);
		  const totalGeral = totais.reduce((acc, val) => acc + val, 0);

		  new Chart(ctx, {
			type: "bar",
			data: {
			  labels: data.porClasse.map(c => c.classe),
			  datasets: [{
				label: "EFECTIVO/CLASSE",
				data: totais,
				backgroundColor: "#36b9cc"
			  }]
			},
			options: {
			  indexAxis: 'y',   // barra horizontal
			  responsive: true,
			  animation: false,
			  plugins: {
					  tooltip: {
		  callbacks: {
			label: function(context) {
			  const value = context.parsed.x; // no gráfico horizontal, o valor está em x
			  const percent = totalGeral > 0 ? ((value / totalGeral) * 100).toFixed(2) : 0;
			  return `${value} (${percent}%)`;
			}
		  }
		},
						legend: { display: true },
		datalabels: {
			anchor: 'center',   // fica dentro da barra
			align: 'center',    // padrão: centralizado

			formatter: function (value) {
				const percent = totalGeral > 0 ? ((value / totalGeral) * 100).toFixed(2) : 0;
				return `${value} (${percent}%)`;
			},

			color: '#003366',
			font: { weight: 'bold' },

			// Ajuste de posição
			align: function (ctx) {
				const value = ctx.dataset.data[ctx.dataIndex];
				const percent = totalGeral > 0 ? ((value / totalGeral) * 100).toFixed(2) : 0;

				return percent == 0 ? 'right' : 'center';
			},

			offset: function (ctx) {
				const value = ctx.dataset.data[ctx.dataIndex];
				const percent = totalGeral > 0 ? ((value / totalGeral) * 100).toFixed(2) : 0;

				// desloca para direita (positivo empurra →)
				return percent == 0 ? 20 : 0;
			}
		}
			  },
			  scales: {
				x: {
				  beginAtZero: true,
				  ticks: { precision: 0 }
				}
			  }
			},
			plugins: [ChartDataLabels]  // importante ativar o plugin aqui
		  });
		}
		// Gráfico por Unidade
					if (document.getElementById("unidadeChart")) {
			const totais = data.porUnidade.map(u => u.total);
			const totalGeral = totais.reduce((acc, val) => acc + val, 0);

			new Chart(document.getElementById("unidadeChart"), {
				type: "bar",
				data: {
					labels: data.porUnidade.map(u => u.unidade),
					datasets: [{
						label: "Efetivos por Unidade",
						data: totais,
						backgroundColor: "#1cc88a"
					}]
				},
				options: {
					responsive: false,
					animation: false,
					plugins: {
						legend: { display: true },
						datalabels: {
							// Configuração para o valor em cima da barra
							display: true,
							labels: {
								valueLabel: {
									anchor: 'end',
									align: 'top',
									formatter: value => value,
									color: '#000',
									font: { weight: 'bold', size: 12 }
								},
								percentLabel: {
									anchor: 'center',
									align: 'center',
									formatter: (value) => {
										const percent = totalGeral > 0 ? ((value / totalGeral) * 100).toFixed(2) : 0;
										return `${percent}%`;
									},
									color: '#003366',
									font: { weight: 'none', size: 12 }
								}
							}
						}
					},
					scales: {
						y: {
							beginAtZero: true,
							ticks: { precision: 0 }
						}
					}
				},
				plugins: [ChartDataLabels]
			});
		}

				// Gráfico por Faixa Etária
			if (document.getElementById("faixaEtariaChart")) {
			const totais = data.porFaixaEtaria.map(f => f.total);
			const totalGeral = totais.reduce((acc, val) => acc + val, 0);

			new Chart(document.getElementById("faixaEtariaChart"), {
				type: "line",
				data: {
					labels: data.porFaixaEtaria.map(f => f.faixa),
					datasets: [{
						label: "Por Faixa Etária",
						data: totais,
						fill: false,
						borderColor: "#2e236f",
						backgroundColor: "#2e236f",
						tension: 0.3,
						pointRadius: 5
					}]
				},
				options: {
					responsive: true,
					animation: false,
					scales: {
						y: {
							beginAtZero: true,
							ticks: { precision: 0 }
						}
					},
					plugins: {
						legend: { display: true },
						tooltip: {
							callbacks: {
								label: function(context) {
									const value = context.parsed.y;
									const percent = totalGeral > 0 ? ((value / totalGeral) * 100).toFixed(2) : 0;
									return ` ${value} (${percent}%)`;
								}
							}
						},
						datalabels: {
							anchor: 'end',
							align: 'top',
							color: '#2e236f',
							font: { weight: 'bold' },
							formatter: function(value) {
								const percent = totalGeral > 0 ? ((value / totalGeral) * 100).toFixed(2) : 0;
								return `${value} (${percent}%)`;
							}
						}
					}
				},
				plugins: [ChartDataLabels]
			});
		}


				// Detalhes por Gênero
				data.porGenero.forEach(g => {
					if (g.genero === "Masculino") {
						setText("totalMasculino", g.total);
						setText("percentagemMasculino", `${g.percentagem}%`);
					} else if (g.genero === "Feminino") {
						setText("totalFeminino", g.total);
						setText("percentagemFeminino", `${g.percentagem}%`);
					}
				});

				// Detalhes por Classe
				const idsClasse = {
					"Oficial Comissário": ["ofComissarios", "percComissarios"],
					"Oficial Superior": ["ofSuperiores", "percSuperiores"],
					"Oficial Subalterno": ["ofSubalternos", "percSubalternos"],
					"Subchefe": ["subchefes", "percSubchefes"],
					"Agente": ["agentes", "percAgentes"]
				};

				data.porClasse.forEach(c => {
					const [totalId, percId] = idsClasse[c.classe] || [];
					if (totalId && percId) {
						setText(totalId, c.total);
						setText(percId, `${c.percentagem}%`);
					}
				});


						$.plot("#classeChartFlot", [{
			data: data.porClasse.map((c, i) => [i, c.total]),
			bars: { show: true, barWidth: 0.5, align: "center", fillColor: "#36b9cc" },
			color: "#36b9cc"
		}], {
			xaxis: {
				ticks: data.porClasse.map((c, i) => [i, c.classe]),
				tickLength: 0
			},
			grid: {
				hoverable: true,
				clickable: true,
				borderColor: "#ccc",
				borderWidth: 1,
				backgroundColor: "#f9f9f9"
			},
			tooltip: true,
			tooltipOpts: {
				content: "%s: %y efetivos",
				shifts: { x: 10, y: 20 }
			}
		});


				// Detalhes por Unidade
				const idsUnidade = {
					"ORGÃOS": ["comandoTotal", "comandoPerc"],
					"UPP": ["uppTotal", "uppPerc"],
					"UPD": ["updTotal", "updPerc"],
					"UPJ": ["upjTotal", "upjPerc"],
					"UPEP": ["upepTotal", "upepPerc"],
					"UGHH": ["ughhTotal", "ughhPerc"],
					"UBM": ["ubmTotal", "ubmPerc"],
					"GABCMDTE": ["gabCmdteTotal", "gabCmdtePerc"],
					"GAB2ºCMDTE": ["gab2CmdteTotal", "gab2CmdtePerc"],
					"GABCEM": ["gabCemTotal", "gabCemPerc"],
					"GABINETES": ["gabinetesTotal", "gabinetesPerc"]
				};

				data.porUnidade.forEach(u => {
					const [totalId, percId] = idsUnidade[u.unidade] || [];
					if (totalId && percId) {
						setText(totalId, u.total);
						setText(percId, `${parseFloat(u.percentagem).toFixed(2)}%`);
					}
				});

			} catch (error) {
				console.error("Erro ao carregar dashboard:", error);
				alert("Não foi possível carregar os dados do dashboard.");
			}
		}
	</script>

	<script>
		$(document).ready(function() {
			// Initialize Peity charts
			$('.peity_line_neutral').peity('line', {
				stroke: '#6c757d',
				strokeWidth: 2,
				fill: false,
				width: 40,
				height: 20
			});

			$('.peity_line_good').peity('line', {
				stroke: '#28a745',
				strokeWidth: 2,
				fill: false,
				width: 40,
				height: 20
			});

			$('.peity_bar_good').peity('bar', {
				fill: ['#007bff'],
				width: 40,
				height: 20
			});

			$('.peity_bar_bad').peity('bar', {
				fill: ['#dc3545'],
				width: 40,
				height: 20
			});

			// Initialize carousel
			$('.carousel').carousel({
				interval: 8000 // Auto-advance every 5 seconds
			});
		});
	</script>

	<script>
		$(function () {
			let allData = [];
			let seriesVisiveis = new Set();

			function carregarGrafico(dados) {
				const datasets = [];

				const labels = dados.labels.map(label => {
					const parts = label.split('-');
					return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, 1).getTime();
				});

				dados.datasets.forEach((serie, idx) => {
					if (seriesVisiveis.size === 0 || seriesVisiveis.has(serie.label)) {
						const pontos = serie.data.map((valor, i) => [labels[i], valor]);
						datasets.push({
							label: serie.label,
							data: pontos,
							lines: { show: true, fill: false, curvedLines: { apply: true } },  // ativar curvas aqui
							points: { show: true },
							color: getColorForLabel(serie.label)
						});
					}
				});

				// Opções do gráfico
				const options = {
					curvedLines: { active: true },  // <-- ATIVA O PLUGIN
					xaxis: {
						mode: "time",
						timeformat: "%b %Y",
						tickSize: [1, "month"],
						minTickSize: 1
					},
					yaxis: {
						min: 0,
						tickDecimals: 0
					},
					grid: {
						hoverable: true,
						clickable: true,
						borderColor: "#ccc",
						borderWidth: 1,
						backgroundColor: "#fff"
					},
					legend: {
						show: true,
						position: "ne",
						noColumns: 2
					},
					tooltip: true,
					tooltipOpts: {
						content: "%s<br>%x: <strong>%y efectivos</strong>"
					}
				};

				$.plot($("#flot-line-chart"), datasets, options);

				$("#flot-line-chart").unbind("plotclick").bind("plotclick", function (event, pos, item) {
					if (item && item.series && item.series.label) {
						const clickedLabel = item.series.label;

						if (seriesVisiveis.size === 0 || !seriesVisiveis.has(clickedLabel)) {
							seriesVisiveis = new Set([clickedLabel]);
						} else {
							seriesVisiveis.clear();
						}

						carregarGrafico(allData);
					}
				});
			}

			function getColorForLabel(label) {
				const colorMap = {
					"Unidade A": "#3366cc",
					"Unidade B": "#dc3912",
					"Unidade C": "#ff9900",
					"Unidade D": "#109618",
					"Unidade E": "#990099"
				};
				return colorMap[label] || getRandomColor();
			}

			function getRandomColor() {
				return '#' + Math.floor(Math.random() * 16777215).toString(16);
			}

			$.getJSON('/Dpq/Home/GraficoEfetivosPorUnidadeMes', function (response) {
				allData = response;
				carregarGrafico(allData);
			});
		});
	</script>

	<script>
		$.getJSON('/Dpq/Home/QuantidadeEfectivosPorPatente', function (data) {
		  const patentes = data.map(item => item.patente);

		  // Obter todas as unidades únicas (para montar as séries)
		  const unidadesSet = new Set();
		  data.forEach(item => {
			Object.keys(item.quantidadePorOrgaoUnidade).forEach(unidade => unidadesSet.add(unidade));
		  });

		  const unidades = Array.from(unidadesSet);

		  // Criar as séries com base nas quantidades
		  const series = unidades.map(unidade => {
			return {
			  name: unidade,
			  data: data.map(item => item.quantidadePorOrgaoUnidade[unidade] || 0)
			};
		  });

		  // Criar um mapa de percentagens para o tooltip
		  const percentagemPorPatente = data.map(item => item.percentagemPorOrgaoUnidade);

		  // Configurar o gráfico
		  const options = {
			chart: {
			  type: 'line',
			  height: 350
			},
			series: series,
			xaxis: {
			  categories: patentes,
			  labels: {
				rotate: -45
			  }
			},
			stroke: {
			  curve: 'smooth',
			  width: 2
			},
			markers: {
			  size: 5
			},
			tooltip: {
			  shared: true,
			  intersect: false,
			  y: {
				formatter: function (val, { seriesIndex, dataPointIndex, w }) {
				  const unidade = w.globals.seriesNames[seriesIndex];
				  const percent = percentagemPorPatente[dataPointIndex]?.[unidade] || 0;
				  return `${val} efectivos (${percent.toFixed(1)}%)`;
				}
			  }
			},
			legend: {
			  position: 'top'
			},
			yaxis: {
			  title: {
				text: 'Quantidade de Efetivos'
			  }
			}
		  };

		  const chart = new ApexCharts(document.querySelector("#graficoEfectivos"), options);
		  chart.render();
		});
	</script>

        }




